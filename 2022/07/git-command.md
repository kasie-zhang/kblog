> Create: 12/30/2020
>
> Last Update: 7/19/2022

# **Git 命令大全**

# Git 常用命令

```bash
git config --global user.name 'username'
git config --global user.email test@test.com      // 设置代码提交时的用户信息; 如果去掉 --global 参数只对当前仓库有效。

git init                                            // 新建本地仓库

git remote add <远程仓库别名> <远程仓库地址>          // 添加远程仓库
git remote -v                                       // 查看远程分支
git remote rm name                                  // 删除远程仓库
git remote rename old_name  new_name                // 修改远程仓库名

git pull <远程主机> <远程分支名>:<本地分支名>          // 从远程获取代码,并合并本地版本

git push <远程主机> <本地分支名>:<远程分支名>          // 将本地分支版本上传到远程并合并

git add .                                            // 将文件添加到暂存区
git status                                           // 查看项目当前的状态
git commit -m [message]                              // 提交暂存区到本地仓库中

git log                                              // 查看历史提交记录

git reset HEAD^                                      // 回退所有内容到上一个版本
git reset HEAD^ hello.php                            // 回退 hello.php 文件的版本到上一个版本
git reset <版本号>                                   // 回退到指定版本
```

# 本地仓库

## Git Commit

Git 仓库中的提交记录保存的是你的目录下所有文件的快照，就像是把整个目录复制，然后再粘贴一样，但比复制粘贴优雅许多！

Git 希望提交记录尽可能地轻量，因此在你每次进行提交时，它并不会盲目地复制整个目录。条件允许的情况下，它会将当前版本与仓库中的上一个版本进行对比，并把所有的差异打包到一起作为一个提交记录。

Git 还保存了提交的历史记录。这也是为什么大多数提交记录的上面都有父节点的原因 —— 我们会在图示中用箭头来表示这种关系。对于项目组的成员来说，维护提交历史对大家都有好处。

关于提交记录太深入的东西咱们就不再继续探讨了，现在你可以把提交记录看作是项目的快照。提交记录非常轻量，可以快速地在这些提交记录之间切换！

## Git Branch

Git 的分支也非常轻量。它们只是简单地指向某个提交纪录 —— 仅此而已。所以许多 Git 爱好者传颂：

`早建分支！多用分支！`

这是因为即使创建再多的分支也不会造成储存或内存上的开销，并且按逻辑分解工作到不同的分支要比维护那些特别臃肿的分支简单多了。

在将分支和提交记录结合起来后，我们会看到两者如何协作。现在只要记住使用分支其实就相当于在说：“我想基于这个提交以及它所有的父提交进行新的工作。”

```bash
git branch dev1             // 新建 dev1 分支
git checkout dev1           // 切换到 dev1 分支

git checkout -b dev2        // 新建一个名叫 dev2 的分支, 并且切换过去
```

## Git Merge

合并分支的第一种方法.

在 Git 中合并两个分支时会产生一个特殊的提交记录，它有两个父节点。翻译成自然语言相当于：“我要把这两个父节点本身及它们所有的祖先都包含进来。”

```bash
git merge <要被合并的分支>         // 将要被合并的分支  合并到 当前分支中
```

## Git Rebase

合并分支的第二种方法.

Rebase 实际上就是取出一系列的提交记录，“复制”它们，然后在另外一个地方逐个的放下去。

Rebase 的优势就是可以创造更线性的提交历史，这听上去有些难以理解。如果只允许使用 Rebase 的话，代码库的提交历史将会变得异常清晰。

```bash
git rebase <要复制到哪个分支>
```

# 远程仓库

远程仓库并不复杂, 在如今的云计算盛行的世界很容易把远程仓库想象成一个富有魔力的东西, 但实际上它们只是你的仓库在另个一台计算机上的拷贝。你可以通过因特网与这台计算机通信 —— 也就是增加或是获取提交记录

话虽如此, 远程仓库却有一系列强大的特性

- 首先也是最重要的的点, 远程仓库是一个强大的备份。本地仓库也有恢复文件到指定版本的能力, 但所有的信息都是保存在本地的。有了远程仓库以后，即使丢失了本地所有数据, 你仍可以通过远程仓库拿回你丢失的数据。

- 还有就是, 远程让代码社交化了! 既然你的项目被托管到别的地方了, 你的朋友可以更容易地为你的项目做贡献(或者拉取最新的变更)

现在用网站来对远程仓库进行可视化操作变得越发流行了(像 [GitHub](https://github.com/) 或 [Phabricator](https://www.phacility.com/), 但远程仓库永远是这些工具的顶梁柱, 因此理解其概念非常的重要!

## Git Clone

当你用 `git clone` 某个仓库时，Git 已经帮你把远程仓库的名称设置为 `origin` 了

## Git Fetch

从远程仓库获取数据, 将本地仓库中的远程分支更新成远程仓库相应分支最新的状态 `git fetch`

`git fetch` 并不会更改本地仓库的状态, 不会更新`main` 分支, 也不会修改磁盘上的文件 !!!

`git fetch` 可以理解为单纯的下载操作

`git fetch` 完成了很重要的两步:

- 从远程仓库下载本地仓库缺失的提交记录
- 更新远程分支指针

## Git Pull

当远程分支中有新的提交时，你可以像合并本地分支那样来合并远程分支。

`git pull` 等价于 `git fetch` + `git merge`

## Git Push

`git push` 负责将你的变更上传到指定的远程仓库，并在远程仓库上合并你的新提交记录。一旦 `git push` 完成, 你的朋友们就可以从这个远程仓库下载你分享的成果了！

Git 会强制你先合并远程最新的代码, 然后才能分享你的工作.

> [!TIP]解决本地仓库 与 远程仓库不同步

> 1.git fetch 更新远程分支
>
> 2.git rebase 将我们的工作移动到最新的提交记录下
>
> 3.git push 推送至远程仓库
>
> 或使用 `git pull --rebase` 实现 (推荐!!!)

## 解决 Remote Rejected

如果你是在一个大的合作团队中工作, 很可能是 master 被锁定了, 需要一些 Pull Request 流程来合并修改。如果你直接提交(commit)到本地 master, 然后试图推送(push)修改, 你将会收到这样类似的信息:
` ! [远程服务器拒绝] main -> main (TF402455: 不允许推送(push)这个分支; 你必须使用pull request来更新这个分支.)`

> [!NOTE] 为什么会被拒绝?

> 远程服务器拒绝直接推送(push)提交到 master, 因为策略配置要求 pull requests 来提交更新.
>
> 你应该按照流程,新建一个分支, 推送(push)这个分支并申请 pull request,但是你忘记并直接提交给了 master.现在你卡住并且无法推送你的更新.
