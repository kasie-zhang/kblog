---
title: Vim 使用技巧
date: 2020-12-03
cover: https://api.zk123.top/link/repo1/img/cover/49.webp
sidebar: 'auto'
categories:
- 笔记
tags:
- Vim
publish: true
permalink: /article/49
---

> 第 49 篇文章
<!-- more -->


**在使用中学习，而不是在记忆中学习！**


- `vim file1 file2 ... filen` 打开文件（不存在则新建）。
- `:e file` 打开文件
- `:q` 退出
- `:q!` 强制退出,放弃更改
- `:wq` 保存文件并退出
- `:sp` split，水平分割窗口
- `:vsp` vertical split，垂直分割窗口
- `Ctrl + `

## 多文件切换
### 1.在文件之间切换
1. 两个文件之间的切换

`Ctrl + 6`

2. 下一个文件

`:bn`

3. 上一个文件

`:bp`

4. 列出打开的文件，带编号

`:ls`

5. 切换至第 n 个文件

`:b1 ~ n`

### 2.在窗格之间切换
**左右切换**
- 左：`Ctrl + h`
- 右：`Ctrl + l`

**上下切换**
- 上：`Ctrl + k`
- 下：`Ctrl + j`

**依次切换**

`Ctrl + ww`

## 文本编辑
### 插入
**INSERT 模式下，新键入的内容都在光标前。**

1. `NORMAL` 模式下，按下 `i` 键进入插入模式，光标不动。
2. `NORMAL` 模式下，按下 `a` 键进入插入模式，光标向后移动一格。
3. `NORMAL` 模式下，按下 `A` 键进入插入模式，光标移动至行尾后一格。
4. `NORMAL` 模式下，按下 `o` 键（小O）进入插入模式，会在当前行的下面新起一行，并将光标移动至新行行首。
5. `NORMAL` 模式下，按下 `O` 键（大O）进入插入模式，会在当前行的上面新起一行，并将光标移动至新行行首。
:::details 举个例子
原始文本：`---a---`，进入vim后，假设光标在字符 `a` 上

按下 `i` 进入 INSERT 模式（光标不动），插入 `222`。

输入完成后的文本为：`---222a---`。

按下 `a` 进入 INSERT 模式（光标向后移动一格），插入 `222`。

输入完成后的文本为：`---a222---`

按下 `A` 进入 INSERT 模式（光标移动至行尾后一格），插入 `222`。

输入完成后的文本为：`---a---222`
:::

### 删除
`NORMAL` 模式下，按下 `x`，删除光标所在处的字符


### 撤销
`NORMAL` 模式下，按下 `u`，撤销最后执行的命令

`NORMAL` 模式下，按下 `U（大写）`，撤销对整行的修改

`NORMAL` 模式下，按下 `CTRL + R`，重新执行被撤销的命令

## 删除类命令

### 删除单词 - dw

`输入 dw 可以从光标处删除至一个单词的结尾`

1. 按下 `ESC` 确保当前处于normal模式
2. 将光标移动至准备要删除的单词的起始处
3. 接着输入`dw`删除该单词

### 从当前光标删除到行末 - d$

1. 按下 `ESC` 确保当前处于normal模式
2. 将光标移动至希望删除文本的起始位置
3. 接着输入 `d&`从光标处删除至当前行尾部

## 关于命令和对象

许多改变文本的命令都由一个操作符和一个动作构成。

```md
d  motion

d		- 删除操作符
motion 	 - 操作符的对象
```

:::tip 动作列表
`w` - （word）从当前光标当前位置直到下一个单词起始处，不包括它的第一个字符

`e` -  从当前光标当前位置直到单词末尾，包括最后一个字符

`$` -  从当前光标当前位置直到当前行末
:::

## 计数指定动作

在动作前输入数字可以重复那么多次

输入 `2w` 使光标向前移动两个单词

输入`3e` 使光标向前移动到第三个单词的末尾

输入 `0（数字零）` 移动到行首

### 使用计数删除更多

`d2w` 连续删除两个单词

## 操作整行

输入 `dd` 可以删除整行

`2dd` 可以连续删除两行

输入 `D` 可以删除当前光标到行末所有的字符



## 置入类命令

输入 `p` 将最后一次删除的内容置入光标之后

输入 `dd` 删除一行，这样会将该行保存到Vim的一个寄存器中

`dd` + `p`  == >  CTRL X + CTRL V

## 替换类指令

输入 `r` 和一个字符，替换光标所在位置的字符

输入 `R` 将会连续替换多个字符

:::tip 提示
替换模式和插入模式相似，不过每个输入的字符都会删除一个已有的字符
:::

## 更改类指令

改变文本直到一个单词的末尾，输入 `ce`

```md
line aaa		// 光标放在i处

执行 ce	=> 进入插入模式，且ine 被删除
```

## 使用c改变更多
```
c  [number] motion

// motion 是动作参数， w - word   $ - 行末
```

### 定位及文件状态

`control + g` 显示当前编辑文件中当前光标所在行位置以及文件状态信息。

`行数 + G（大写）` 跳转到 指定行

`G` 跳转到文件末尾

`gg` 跳转到文件开头

### 搜索类指令

`/ + 字符串` 可以在当前文件中查找该字符串

`n` 查看下一个 匹配的 字符串

`N` 查看上一个 匹配的 字符串


:::tip 提示
如果查找已经到达文件末尾，查找会自动从文件头部继续查找，除非'wrapscan'选项被复位
:::

### 配对括号的查找
输入 `%` 可以查找 配对的括号 ), ], }

:::tip 提示
在程序调试时，这个功能来查找不匹配的括号是非常有用的。
:::

### 替换命名
输入 `:s/old/new/g` 可以替换old为new

```md
输入 :s/old/new <enter>          只改变光标所在行的第一个匹配串

输入 :s/old/new/g <enter>        替换全行的匹配串

输入 :#行号1,#行号2 s/old/new/g   替换对应两行中所有的匹配串

输入 :%s/old/new/g               替换整个文件中的每个匹配串

输入 :%s/old/new/gc              找到整个文件中的每个匹配串，并且对每个匹配串提示是否尽心替换
```

### 在Vim内执行外部命令
输入`:!命令` 即可执行外部命令

### 保存文件的更多信息
要将对文件的改动保存到文件中，请输入 `:w FILENAME`

### 具有选择性的保存命令
要保存部分内容， 请输入 `v motion :w  FILENAME`

:::details 操作步骤
1. 按下 `v` 键， 移动光标。你会注意到之间的文本被高亮了
2. 按下 `:` 字符， 你会看到屏幕底部出现了 `:'<',>`
3. 现在输入 `w FILENAME` 然后回车
4. 这时Vim会吧选中的行写入到以FILENAME命名的文件中去
:::

:::tip 提示
按下 `v` 键使Vim进入可视模式进行选取。你可以四处移动光标使选取区域变大或变小。

接着你可以使用一个操作符对选中的文本进行操作。例如按下 `d` 键会删除选中的文本内容。
:::

### 合并和提取文件
通过命令 `:r Test` 将前面创建的名为Test的文件提取进来，你所提取进来的文件将从光标所在位置处开始置入

:::tip 读取外部命令的输出
例如, `:r !dir` 可以读取 dir 命令的输出，并把它放在光标下面
:::

### 打开类命令
输入 `o` 将在光标的下方打开新的一行并进入插入模式

输入 `O（大写）` 将在光标的上方打开新的一行并进入插入模式

### 附加类命令
输入 `a` 将在光标之后插入文本

输入 `A` 将在本行末尾插入文本
:::tip
`a`、`i`、`A` 都会带你进入插入模式，唯一的区别在于字符串插入的位置
:::

### 复制粘贴文本
使用操作符 `y` 复制文本， 使用 `p` 粘贴文本

:::details 操作步骤
1. 先使用用 `v` 进入可视模式
2. 选中需要复制的文本（使用`$`可以直接转到行末）
3. 使用 `y` 以复制高亮的文本
4. 使用`p`粘贴复制了的文本
:::

:::tip 提示
可以把 `y`当做操作符使用，例如 `y[number]w`可以用来复制 number 个单词
:::

### 设置类命令的选项
设置可使查找或替换可忽略大小写的选项

输入 `:set ic`  设置忽略大小写    ic =>  ignore case

输入 `:set noic` 设置不忽略大小写 （默认不忽略大小写）

输入 `:set hls`  设置高亮         hls => highlight search  

输入 `:set nohls` 取消高亮

:::tip 提示
仅在第一次查找时忽略字[母]()大小写，可以使用 `\c`
:::
### 获取帮助信息
使用在线帮助系统  输入 `:help`

输入 `CTRL-W CTRL-W` （连续输入两次）可以帮助你在窗口之间跳转

### 启用Vim特性
Vim的功能要比Vi多得多，但是其中大部分都未启用。为了使用更多的特性，你得创建一个`vimrc`文件

1. 开始编辑 `vimrc` 文件
    - edit ~/.vimrc      这是Unix 系统使用的命令
    - edit $VIM/_vimrc   这是MS-Windows 系统使用的命令

2. 读取 vimrc 示例文件的内容
```md
:r $VIMRUNTIME/vimrc_example.vim
```

3. 保存文件
```md
:write
```

下一次启动 Vim 时，编辑器就有了语法高亮的功能。你可以把你喜欢的各种配置添加到 `vimrc`文件中。

要了解更多信息请输入 `:help vimrc-intro`

### 补全功能
使用 `CTRL-D` 和 `<TAB>`可以进行命令补全

例如 输入`:e` 接着按 `CTRL-D`键，Vim会显示以e开头的命令的列表

## Vim 键盘宏
Vim 提供了一系列寄存器,可以由用户去修改写入。寄存器名可以是 `a-z` 和 `A-Z`，用于保存临时数据。通过 `:reg a` 查看寄存器 a 的内容。

键盘宏就是创建一个寄存器，将我们针对文本的操作指令记录到寄存器中，再将寄存器中的内容应用到其他文本行中。

- **变量赋值**
```vim
:let i=1
:let str="kasie"
```

- **变量取值**
```vim
<ctrl> r=i     " 插入模式下，ctrl + r = i 会在当前位置插入 i 的值
```

- **改变变量的值**
```vim
:let i+=1;
```

- **多行批量操作**
```vim
" 可视化操作选中除了第一行之外的所有行
:normal @a  " 将寄存器内容应用在选中的多行中
```

- **录制键盘宏的步骤**
```vim
qa              " 第一次按 q 表示开始录制；a 表示录制以 a 命名的寄存器
do something    " 执行一些针对文本的操作
q               " 第二次按 q 表示结束录制；两个 q 之间的文本操作已经保存到寄存器 a 之中了
```

**举个例子：**
```vim
:let a = "|`"    " 初始化变量 a
:let b = "`|"    " 初始化变量 b
qa               " 开始录制键盘宏，名称为 a
i <ctrl> r = a [ESC] $ a <ctrl> r = b w w       
" i               进入输入模式 
" <ctrl> r = a    插入变量a的值 
" [ESC]           退出输入模式
" $               光标移至行尾
" a               进入输入模式，光标在后
" <ctrl> r = b    插入变量b的值
" w               下一个word  作用等价于换行
" w               下一个word  作用等价与换行
q                 " 键盘宏录制结束

@a                " 调用名为a的键盘宏
```

动图演示：
![](https://api.zk123.top/link/repo1/img/2022/49_1.gif)

键盘宏入门比较麻烦，但入门之后就会发现这些学习时间与成千上万次枯燥的重复操作来说还是值得的。